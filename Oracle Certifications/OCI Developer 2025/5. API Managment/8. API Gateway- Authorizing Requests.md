L’**autorizzazione** in **OCI API Gateway** si basa sulla verifica dell’identità del client e dei permessi associati, prima di consentire l’accesso alle risorse di back-end.  
Uno degli scenari più comuni è l’uso di **OAuth 2.0** con **JSON Web Token (JWT)**.

---

## 🔐 Flusso OAuth tipico

1. **Il client** (applicazione) richiede un **token di autorizzazione** a un **Authorization Server** (es. Oracle Identity Cloud Service, Okta, Auth0).
2. La richiesta può avvenire:
    - Con le sole credenziali del client (client credentials flow).
    - Reindirizzando l’utente a una pagina di login (authorization code flow).
3. Se le credenziali sono valide, l’Authorization Server rilascia un **Access Token** (JWT).
4. Il client invia l’Access Token insieme alla richiesta API verso l’**API Gateway**.
5. L’API Gateway:
    - Valida il token usando le **JSON Web Keys (JWK)** dell’Authorization Server.
    - Verifica che il token non sia stato alterato e che non sia scaduto.
    - Controlla che i **scope** richiesti siano presenti.
6. Se la validazione ha successo, la richiesta viene inoltrata al servizio di back-end e la risposta restituita al client.

---

## 🛠 Opzioni di autenticazione in API Gateway

Secondo la documentazione ufficiale OCI, l’API Gateway supporta:

- **Validazione diretta del JWT** con un Identity Provider.
- **Authorizer Function**: il gateway passa il token a una funzione in **OCI Functions** per la validazione personalizzata.
- Possibilità di configurare **più authentication server** nello stesso deployment, anche di tipologia diversa.
- Routing dinamico verso l’autenticatore corretto in base a elementi della richiesta.

> **Nota**: L’uso di authentication server è **opzionale**. Non è vero che ogni deployment ne richieda uno o più obbligatoriamente.

---

## ❓ Domanda di Verifica

**Quale affermazione relativa alle opzioni del server di autenticazione per la distribuzione di API Gateway NON è valida?**

1️⃣ È possibile fare in modo che API Gateway trasmetta un token di accesso incluso in una richiesta a una funzione di autorizzazione distribuita su OCI Functions per eseguire la convalida.
2️⃣ Ogni distribuzione richiede uno o più server di autenticazione.
3️⃣ I server di autenticazione configurati possono essere dello stesso tipo o di tipo diverso all'interno della stessa distribuzione.
4️⃣ È possibile configurare più server di autenticazione per la stessa distribuzione API.

#### ❌ Risposta alla domanda

**Opzione NON valida**:

>2️⃣ _Ogni distribuzione richiede uno o più server di autenticazione._  
>     Non valida: un deployment può non avere alcun authentication server, se le API sono pubbliche o protette in altro modo.

---

## 📊 Schema visivo – Flusso di autorizzazione con API Gateway

```
[Client App]
   │ Richiesta token
   ▼
[Authorization Server] → Rilascia JWT
   │
   ▼
[API Gateway]
   │ Valida JWT (JWK / Authorizer Fn)
   │ Controlla scope
   ▼
[Backend Service]
   │
   ▼
[API Gateway] → Risposta al client
```

---

## 📚 Glossario

|Termine|Definizione|
|---|---|
|**OAuth 2.0**|Protocollo standard per l’autorizzazione sicura tra applicazioni.|
|**JWT (JSON Web Token)**|Token compatto e firmato digitalmente che trasporta informazioni di autenticazione/autorizzazione.|
|**Scope**|Permessi specifici concessi a un token per accedere a determinate risorse o operazioni.|
|**JWK (JSON Web Key)**|Chiave pubblica usata per verificare la firma di un JWT.|
|**Authorizer Function**|Funzione OCI che esegue logica personalizzata di validazione del token.|

---
