Lâ€™**autorizzazione** in **OCI API Gateway** si basa sulla verifica dellâ€™identitÃ  del client e dei permessi associati, prima di consentire lâ€™accesso alle risorse di back-end.  
Uno degli scenari piÃ¹ comuni Ã¨ lâ€™uso di **OAuth 2.0** con **JSON Web Token (JWT)**.

---

## ðŸ” Flusso OAuth tipico

1. **Il client** (applicazione) richiede un **token di autorizzazione** a un **Authorization Server** (es. Oracle Identity Cloud Service, Okta, Auth0).
2. La richiesta puÃ² avvenire:
    - Con le sole credenziali del client (client credentials flow).
    - Reindirizzando lâ€™utente a una pagina di login (authorization code flow).
3. Se le credenziali sono valide, lâ€™Authorization Server rilascia un **Access Token** (JWT).
4. Il client invia lâ€™Access Token insieme alla richiesta API verso lâ€™**API Gateway**.
5. Lâ€™API Gateway:
    - Valida il token usando le **JSON Web Keys (JWK)** dellâ€™Authorization Server.
    - Verifica che il token non sia stato alterato e che non sia scaduto.
    - Controlla che i **scope** richiesti siano presenti.
6. Se la validazione ha successo, la richiesta viene inoltrata al servizio di back-end e la risposta restituita al client.

---

## ðŸ›  Opzioni di autenticazione in API Gateway

Secondo la documentazione ufficiale OCI, lâ€™API Gateway supporta:

- **Validazione diretta del JWT** con un Identity Provider.
- **Authorizer Function**: il gateway passa il token a una funzione in **OCI Functions** per la validazione personalizzata.
- PossibilitÃ  di configurare **piÃ¹ authentication server** nello stesso deployment, anche di tipologia diversa.
- Routing dinamico verso lâ€™autenticatore corretto in base a elementi della richiesta.

> **Nota**: Lâ€™uso di authentication server Ã¨ **opzionale**. Non Ã¨ vero che ogni deployment ne richieda uno o piÃ¹ obbligatoriamente.

---

## â“ Domanda di Verifica

**Quale affermazione relativa alle opzioni del server di autenticazione per la distribuzione di API Gateway NON Ã¨ valida?**

1ï¸âƒ£ Ãˆ possibile fare in modo che API Gateway trasmetta un token di accesso incluso in una richiesta a una funzione di autorizzazione distribuita su OCI Functions per eseguire la convalida.
2ï¸âƒ£ Ogni distribuzione richiede uno o piÃ¹ server di autenticazione.
3ï¸âƒ£ I server di autenticazione configurati possono essere dello stesso tipo o di tipo diverso all'interno della stessa distribuzione.
4ï¸âƒ£ Ãˆ possibile configurare piÃ¹ server di autenticazione per la stessa distribuzione API.

#### âŒ Risposta alla domanda

**Opzione NON valida**:

>2ï¸âƒ£ _Ogni distribuzione richiede uno o piÃ¹ server di autenticazione._  
>     Non valida: un deployment puÃ² non avere alcun authentication server, se le API sono pubbliche o protette in altro modo.

---

## ðŸ“Š Schema visivo â€“ Flusso di autorizzazione con API Gateway

```
[Client App]
   â”‚ Richiesta token
   â–¼
[Authorization Server] â†’ Rilascia JWT
   â”‚
   â–¼
[API Gateway]
   â”‚ Valida JWT (JWK / Authorizer Fn)
   â”‚ Controlla scope
   â–¼
[Backend Service]
   â”‚
   â–¼
[API Gateway] â†’ Risposta al client
```

---

## ðŸ“š Glossario

|Termine|Definizione|
|---|---|
|**OAuth 2.0**|Protocollo standard per lâ€™autorizzazione sicura tra applicazioni.|
|**JWT (JSON Web Token)**|Token compatto e firmato digitalmente che trasporta informazioni di autenticazione/autorizzazione.|
|**Scope**|Permessi specifici concessi a un token per accedere a determinate risorse o operazioni.|
|**JWK (JSON Web Key)**|Chiave pubblica usata per verificare la firma di un JWT.|
|**Authorizer Function**|Funzione OCI che esegue logica personalizzata di validazione del token.|

---
