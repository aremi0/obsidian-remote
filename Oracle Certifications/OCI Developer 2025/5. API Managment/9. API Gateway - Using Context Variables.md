Le **context variables** in **OCI API Gateway** sono valori temporanei che il servizio estrae dalla richiesta o dal contesto di esecuzione e che possono essere riutilizzati in **policy di richiesta/risposta** o nelle definizioni di back-end HTTP/HTTPS.  
Sono fondamentali per creare API dinamiche, trasformare richieste e risposte e implementare logiche di routing avanzate.

---

## ğŸ” Tipi principali di context variables

- **`request.path`**  
    Contiene i valori dei **path parameters** definiti nella API Deployment Specification.  
    Esempio:
    
    ```
    GET /pets/cats/{id}
    request.path.id = "42"
    ```
    
- **`request.query`**  
    Contiene i parametri passati nella query string della richiesta.  
    Esempio:
    
    ```
    GET /pets/cats?id=42&type=siamese
    request.query.id = "42"
    request.query.type = "siamese"
    ```
    
- **`request.headers`**  
    Contiene i valori degli header HTTP inviati dal client.  
    Esempio:
    
    ```
    request.headers.Accept = "application/json"
    ```
    
- **`request.auth`**  
    Contiene i **claims** estratti da un token JWT o restituiti da unâ€™**Authorizer Function**.
    

---

## ğŸ“Œ Altre context variables supportate (fonti ufficiali OCI)

- **`request.cert`** â†’ certificato client (Base64) validato in handshake mTLS.
- **`request.host`** â†’ nome host della richiesta (da header `Host`).
- **`request.subdomain`** â†’ parte iniziale del nome host.
- **`request.usage_plan`** â†’ OCID del piano di utilizzo associato al client.
- **`request.body`** â†’ corpo della richiesta (solo per Authorizer Function multi-argomento).

---

## ğŸš« Variabili non esistenti

Non esiste alcuna variabile di contesto chiamata **`request.client`**.  
Le variabili valide sono quelle documentate ufficialmente.

---

## ğŸ›  Esempio di utilizzo in backend definition

```json
{
  "routes": [
    {
      "path": "/pets/cats/{id}",
      "methods": ["GET"],
      "backend": {
        "type": "HTTP_BACKEND",
        "url": "https://backend.example.com/cats/${request.path.id}?lang=${request.query.lang}"
      }
    }
  ]
}
```

In questo esempio:

- `${request.path.id}` â†’ cattura lâ€™ID dal percorso.
- `${request.query.lang}` â†’ cattura il parametro `lang` dalla query string.

---

## ğŸ“Š Schema visivo â€“ Flusso delle context variables

```
[Client Request]
   â”‚
   â”œâ”€ Path â†’ request.path
   â”œâ”€ Query String â†’ request.query
   â”œâ”€ Headers â†’ request.headers
   â”œâ”€ Token Claims â†’ request.auth
   â”œâ”€ Certificato mTLS â†’ request.cert
   â””â”€ Host Info â†’ request.host / request.subdomain
```

---

## ğŸ“š Glossario

|Termine|Definizione|
|---|---|
|**Context Variable**|Variabile temporanea che memorizza valori estratti dalla richiesta o dal contesto di esecuzione.|
|**Path Parameter**|Segmento variabile dellâ€™URL racchiuso tra `{}`.|
|**Query String**|Parametri aggiuntivi passati nellâ€™URL dopo il simbolo `?`.|
|**Authorizer Function**|Funzione OCI che valida credenziali o token e puÃ² restituire claims in `request.auth`.|
|**mTLS**|Autenticazione reciproca TLS, in cui sia client che server presentano certificati validi.|

---
