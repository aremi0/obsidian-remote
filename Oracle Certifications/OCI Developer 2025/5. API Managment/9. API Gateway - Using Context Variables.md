Le **context variables** in **OCI API Gateway** sono valori temporanei che il servizio estrae dalla richiesta o dal contesto di esecuzione e che possono essere riutilizzati in **policy di richiesta/risposta** o nelle definizioni di back-end HTTP/HTTPS.  
Sono fondamentali per creare API dinamiche, trasformare richieste e risposte e implementare logiche di routing avanzate.

---

## 🔍 Tipi principali di context variables

- **`request.path`**  
    Contiene i valori dei **path parameters** definiti nella API Deployment Specification.  
    Esempio:
    
    ```
    GET /pets/cats/{id}
    request.path.id = "42"
    ```
    
- **`request.query`**  
    Contiene i parametri passati nella query string della richiesta.  
    Esempio:
    
    ```
    GET /pets/cats?id=42&type=siamese
    request.query.id = "42"
    request.query.type = "siamese"
    ```
    
- **`request.headers`**  
    Contiene i valori degli header HTTP inviati dal client.  
    Esempio:
    
    ```
    request.headers.Accept = "application/json"
    ```
    
- **`request.auth`**  
    Contiene i **claims** estratti da un token JWT o restituiti da un’**Authorizer Function**.
    

---

## 📌 Altre context variables supportate (fonti ufficiali OCI)

- **`request.cert`** → certificato client (Base64) validato in handshake mTLS.
- **`request.host`** → nome host della richiesta (da header `Host`).
- **`request.subdomain`** → parte iniziale del nome host.
- **`request.usage_plan`** → OCID del piano di utilizzo associato al client.
- **`request.body`** → corpo della richiesta (solo per Authorizer Function multi-argomento).

---

## 🚫 Variabili non esistenti

Non esiste alcuna variabile di contesto chiamata **`request.client`**.  
Le variabili valide sono quelle documentate ufficialmente.

---

## 🛠 Esempio di utilizzo in backend definition

```json
{
  "routes": [
    {
      "path": "/pets/cats/{id}",
      "methods": ["GET"],
      "backend": {
        "type": "HTTP_BACKEND",
        "url": "https://backend.example.com/cats/${request.path.id}?lang=${request.query.lang}"
      }
    }
  ]
}
```

In questo esempio:

- `${request.path.id}` → cattura l’ID dal percorso.
- `${request.query.lang}` → cattura il parametro `lang` dalla query string.

---

## 📊 Schema visivo – Flusso delle context variables

```
[Client Request]
   │
   ├─ Path → request.path
   ├─ Query String → request.query
   ├─ Headers → request.headers
   ├─ Token Claims → request.auth
   ├─ Certificato mTLS → request.cert
   └─ Host Info → request.host / request.subdomain
```

---

## 📚 Glossario

|Termine|Definizione|
|---|---|
|**Context Variable**|Variabile temporanea che memorizza valori estratti dalla richiesta o dal contesto di esecuzione.|
|**Path Parameter**|Segmento variabile dell’URL racchiuso tra `{}`.|
|**Query String**|Parametri aggiuntivi passati nell’URL dopo il simbolo `?`.|
|**Authorizer Function**|Funzione OCI che valida credenziali o token e può restituire claims in `request.auth`.|
|**mTLS**|Autenticazione reciproca TLS, in cui sia client che server presentano certificati validi.|

---
