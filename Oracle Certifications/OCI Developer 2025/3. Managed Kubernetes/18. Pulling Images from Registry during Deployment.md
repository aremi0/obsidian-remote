Durante il deployment di unâ€™applicazione su Kubernetes, il file `deployment.yaml` (o manifest) specifica:

- **Immagini** da pullare
- **Registry** da cui scaricarle
- **Credenziali** da usare per lâ€™accesso (se il registry Ã¨ privato)

---

### ğŸ”‘ Step 1 â€“ Creare il Docker Registry Secret

Per permettere al cluster di scaricare immagini da **Oracle Cloud Infrastructure Registry (OCIR)**, bisogna creare un **secret** contenente le credenziali OCI.

Comando:

```bash
kubectl create secret docker-registry <secret-name> \
  --docker-server=<region-key>.ocir.io \
  --docker-username='<tenancy-namespace>/<oci-username>' \
  --docker-password='<oci-auth-token>' \
  --docker-email=<email-address>
```

**Parametri principali:**

- `<secret-name>` â†’ Nome del secret (es. `ocirsecret`)
- `<region-key>` â†’ Codice regione OCIR (es. `fra`, `iad`)
- `<tenancy-namespace>` â†’ Namespace Object Storage della tenancy
- `<oci-username>` â†’ Username OCI (o `dominio/username` se federato)
- `<oci-auth-token>` â†’ Auth token generato in OCI Console
- `<email-address>` â†’ Email (puÃ² essere qualsiasi, ma Ã¨ obbligatoria)

---

### ğŸ“ Step 2 â€“ Riferire il Secret nel Manifest

Nel file `deployment.yaml`, nella sezione `spec.template.spec`, aggiungere:

```yaml
imagePullSecrets:
  - name: <secret-name>
```

E nella definizione del container:

```yaml
containers:
  - name: my-app
    image: <region-key>.ocir.io/<tenancy-namespace>/<repository>:<tag>
```

---

### âš™ï¸ Deployment e ReplicaSet

- Un **Deployment** crea e gestisce un **ReplicaSet**
- Il **ReplicaSet** garantisce che sia sempre in esecuzione il numero desiderato di **Pod**
- Se un Pod fallisce, Kubernetes lo ricrea automaticamente

---

### ğŸ“‚ Kubeconfig

- File di configurazione usato da `kubectl` per autenticarsi e accedere al cluster
- Contiene:
    - Nome cluster
    - Endpoint API
    - Credenziali
- Permette di gestire **piÃ¹ cluster** cambiando contesto (`kubectl config use-context <context>`)

---

## ğŸ“š Glossario

|Termine|Definizione|
|---|---|
|**OCIR**|Oracle Cloud Infrastructure Registry, servizio per immagini container|
|**Secret**|Oggetto Kubernetes per memorizzare dati sensibili (es. credenziali)|
|**imagePullSecrets**|Campo del manifest per indicare i secret da usare per il pull delle immagini|
|**Deployment**|Oggetto K8s che gestisce ReplicaSet e Pod|
|**ReplicaSet**|Mantiene un numero costante di Pod in esecuzione|
|**Kubeconfig**|File di configurazione per `kubectl`|

---
