Durante il deployment di un’applicazione su Kubernetes, il file `deployment.yaml` (o manifest) specifica:

- **Immagini** da pullare
- **Registry** da cui scaricarle
- **Credenziali** da usare per l’accesso (se il registry è privato)

---

### 🔑 Step 1 – Creare il Docker Registry Secret

Per permettere al cluster di scaricare immagini da **Oracle Cloud Infrastructure Registry (OCIR)**, bisogna creare un **secret** contenente le credenziali OCI.

Comando:

```bash
kubectl create secret docker-registry <secret-name> \
  --docker-server=<region-key>.ocir.io \
  --docker-username='<tenancy-namespace>/<oci-username>' \
  --docker-password='<oci-auth-token>' \
  --docker-email=<email-address>
```

**Parametri principali:**

- `<secret-name>` → Nome del secret (es. `ocirsecret`)
- `<region-key>` → Codice regione OCIR (es. `fra`, `iad`)
- `<tenancy-namespace>` → Namespace Object Storage della tenancy
- `<oci-username>` → Username OCI (o `dominio/username` se federato)
- `<oci-auth-token>` → Auth token generato in OCI Console
- `<email-address>` → Email (può essere qualsiasi, ma è obbligatoria)

---

### 📝 Step 2 – Riferire il Secret nel Manifest

Nel file `deployment.yaml`, nella sezione `spec.template.spec`, aggiungere:

```yaml
imagePullSecrets:
  - name: <secret-name>
```

E nella definizione del container:

```yaml
containers:
  - name: my-app
    image: <region-key>.ocir.io/<tenancy-namespace>/<repository>:<tag>
```

---

### ⚙️ Deployment e ReplicaSet

- Un **Deployment** crea e gestisce un **ReplicaSet**
- Il **ReplicaSet** garantisce che sia sempre in esecuzione il numero desiderato di **Pod**
- Se un Pod fallisce, Kubernetes lo ricrea automaticamente

---

### 📂 Kubeconfig

- File di configurazione usato da `kubectl` per autenticarsi e accedere al cluster
- Contiene:
    - Nome cluster
    - Endpoint API
    - Credenziali
- Permette di gestire **più cluster** cambiando contesto (`kubectl config use-context <context>`)

---

## 📚 Glossario

|Termine|Definizione|
|---|---|
|**OCIR**|Oracle Cloud Infrastructure Registry, servizio per immagini container|
|**Secret**|Oggetto Kubernetes per memorizzare dati sensibili (es. credenziali)|
|**imagePullSecrets**|Campo del manifest per indicare i secret da usare per il pull delle immagini|
|**Deployment**|Oggetto K8s che gestisce ReplicaSet e Pod|
|**ReplicaSet**|Mantiene un numero costante di Pod in esecuzione|
|**Kubeconfig**|File di configurazione per `kubectl`|

---
